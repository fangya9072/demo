var _interopRequireDefault=require("@babel/runtime/helpers/interopRequireDefault");Object.defineProperty(exports,"__esModule",{value:true});exports.default=void 0;var _extends2=_interopRequireDefault(require("@babel/runtime/helpers/extends"));var _classCallCheck2=_interopRequireDefault(require("@babel/runtime/helpers/classCallCheck"));var _createClass2=_interopRequireDefault(require("@babel/runtime/helpers/createClass"));var _possibleConstructorReturn2=_interopRequireDefault(require("@babel/runtime/helpers/possibleConstructorReturn"));var _getPrototypeOf2=_interopRequireDefault(require("@babel/runtime/helpers/getPrototypeOf"));var _inherits2=_interopRequireDefault(require("@babel/runtime/helpers/inherits"));var _react=_interopRequireDefault(require("react"));var _reactNative=require("react-native");var _propTypes=_interopRequireDefault(require("prop-types"));var _jsxFileName="/home/oxyii/WebstormProjects/@oxyii/react-native-web-swiper/src/index.js";var styles=_reactNative.StyleSheet.create({container:{flex:1,backgroundColor:"transparent"},sliderContainer:{backgroundColor:"transparent",overflow:"hidden",position:"relative",flex:1},controlsWrapperStyle:{position:"absolute",alignItems:"center",justifyContent:"space-between",right:0,bottom:0,padding:10},dotsWrapperStyle:{alignItems:"center",justifyContent:"center"},activeDotStyle:{backgroundColor:'#ADD8E6',width:8,height:8,borderRadius:4,marginLeft:3,marginRight:3,marginTop:3,marginBottom:3},dotStyle:{backgroundColor:'rgba(0,0,0,.2)',width:8,height:8,borderRadius:4,marginLeft:3,marginRight:3,marginTop:3,marginBottom:3},prevButtonStyle:{color:'#777777'},nextButtonStyle:{color:'#007aff'}});var Swiper=function(_React$Component){(0,_inherits2.default)(Swiper,_React$Component);function Swiper(props){var _this;(0,_classCallCheck2.default)(this,Swiper);_this=(0,_possibleConstructorReturn2.default)(this,(0,_getPrototypeOf2.default)(Swiper).call(this,props));_this.state={width:0,height:0,activeIndex:props.index,pan:new _reactNative.Animated.ValueXY()};_this._animatedValueX=0;_this._animatedValueY=0;_this._panResponder=_reactNative.PanResponder.create({onPanResponderTerminationRequest:function onPanResponderTerminationRequest(){return false;},onMoveShouldSetResponderCapture:function onMoveShouldSetResponderCapture(){return true;},onMoveShouldSetPanResponderCapture:function onMoveShouldSetPanResponderCapture(e,gestureState){var allow=Math.abs(_this.props.direction==="row"?gestureState.dx:gestureState.dy)>5;if(allow)_this.stopAutoplay();return allow;},onPanResponderGrant:function onPanResponderGrant(e,gestureState){return _this._fixState();},onPanResponderMove:_reactNative.Animated.event([null,_this.props.direction==="row"?{dx:_this.state.pan.x}:{dy:_this.state.pan.y}]),onPanResponderRelease:function onPanResponderRelease(e,gesture){var correction=_this.props.direction==="row"?gesture.moveX-gesture.x0:gesture.moveY-gesture.y0;_this.startAutoplay();if(Math.abs(correction)<(_this.props.direction==="row"?_this.state.width:_this.state.height)*_this.props.actionMinWidth)return _reactNative.Animated.spring(_this.state.pan,{toValue:{x:0,y:0}}).start();_this._changeIndex(correction>0?-1:1);}});return _this;}(0,_createClass2.default)(Swiper,[{key:"componentDidMount",value:function componentDidMount(){var _this2=this;this.state.pan.x.addListener(function(value){return _this2._animatedValueX=value.value;});this.state.pan.y.addListener(function(value){return _this2._animatedValueY=value.value;});this.startAutoplay();}},{key:"componentWillUnmount",value:function componentWillUnmount(){this.stopAutoplay();this.state.pan.x.removeAllListeners();this.state.pan.y.removeAllListeners();}},{key:"startAutoplay",value:function startAutoplay(){var _this3=this;this.stopAutoplay();if(!!this.props.autoplayTimeout){this.autoplay=setTimeout(function(){_this3.moveUpDown(_this3.props.autoplayTimeout<0);},Math.abs(this.props.autoplayTimeout)*1000);}}},{key:"stopAutoplay",value:function stopAutoplay(){if(!!this.autoplay)clearTimeout(this.autoplay);}},{key:"moveUpDown",value:function moveUpDown(){var down=arguments.length>0&&arguments[0]!==undefined?arguments[0]:false;this._fixState();this._changeIndex(down?-1:1);}},{key:"_fixState",value:function _fixState(){this._animatedValueX=this.props.direction==="row"?this.state.width*this.state.activeIndex*-1:0;this._animatedValueY=this.props.direction==="row"?0:this.state.height*this.state.activeIndex*-1;this.state.pan.setOffset({x:this._animatedValueX,y:this._animatedValueY});this.state.pan.setValue({x:0,y:0});}},{key:"_changeIndex",value:function _changeIndex(){var delta=arguments.length>0&&arguments[0]!==undefined?arguments[0]:1;var move={x:0,y:0};var skipChanges=!delta;var calcDelta=delta;if(this.state.activeIndex<=0&&delta<0){skipChanges=!this.props.loop;calcDelta=this.count+delta;}else if(this.state.activeIndex+1>=this.count&&delta>0){skipChanges=!this.props.loop;calcDelta=-1*this.state.activeIndex+delta-1;}if(skipChanges)return _reactNative.Animated.spring(this.state.pan,{toValue:move}).start();this.stopAutoplay();var index=this.state.activeIndex+calcDelta;this.setState({activeIndex:index});if(this.props.direction==="row")move.x=this.state.width*-1*calcDelta;else move.y=this.state.height*-1*calcDelta;_reactNative.Animated.spring(this.state.pan,{toValue:move}).start();this.startAutoplay();if(!!this.props.onIndexChanged)this.props.onIndexChanged(index);}},{key:"_onLayout",value:function _onLayout(event){var _this4=this;var _event$nativeEvent$la=event.nativeEvent.layout,width=_event$nativeEvent$la.width,height=_event$nativeEvent$la.height;this.setState({width:width,height:height},function(){return _this4._fixState();});}},{key:"render",value:function render(){var _this5=this;var _this$state=this.state,pan=_this$state.pan,width=_this$state.width,height=_this$state.height,activeIndex=_this$state.activeIndex;var _this$props=this.props,direction=_this$props.direction,containerStyle=_this$props.containerStyle,swipeAreaStyle=_this$props.swipeAreaStyle,swipeWrapperStyle=_this$props.swipeWrapperStyle,controlsWrapperStyle=_this$props.controlsWrapperStyle,dotsWrapperStyle=_this$props.dotsWrapperStyle,dotElement=_this$props.dotElement,dotStyle=_this$props.dotStyle,activeDotElement=_this$props.activeDotElement,activeDotStyle=_this$props.activeDotStyle,prevButtonElement=_this$props.prevButtonElement,prevButtonStyle=_this$props.prevButtonStyle,prevButtonText=_this$props.prevButtonText,nextButtonElement=_this$props.nextButtonElement,nextButtonStyle=_this$props.nextButtonStyle,nextButtonText=_this$props.nextButtonText,loop=_this$props.loop;if(!width)return _react.default.createElement(_reactNative.View,{style:[styles.container,containerStyle],onLayout:this._onLayout.bind(this),__source:{fileName:_jsxFileName,lineNumber:189}});var overRangeButtonsOpacity=!loop?this.props.overRangeButtonsOpacity:this.props.overRangeButtonsOpacity||1;var children=this.props.children;if(!Array.isArray(children))children=[children];this.count=children.length;return _react.default.createElement(_reactNative.View,{style:[styles.container,containerStyle],onLayout:this._onLayout.bind(this),__source:{fileName:_jsxFileName,lineNumber:195}},_react.default.createElement(_reactNative.View,{style:[styles.sliderContainer,swipeAreaStyle],__source:{fileName:_jsxFileName,lineNumber:196}},_react.default.createElement(_reactNative.Animated.View,(0,_extends2.default)({style:[{position:"relative",top:0,left:0},swipeWrapperStyle,{flexDirection:direction,width:direction==="row"?width*this.count:width,height:direction==="row"?height:height*this.count},{transform:[{translateX:pan.x},{translateY:pan.y}]}]},this._panResponder.panHandlers,{__source:{fileName:_jsxFileName,lineNumber:197}}),children.map(function(el,i){return _react.default.createElement(_reactNative.View,{key:i,style:{width:width,height:height},__source:{fileName:_jsxFileName,lineNumber:209}},el);})),_react.default.createElement(_reactNative.View,{style:[styles.controlsWrapperStyle,{flexDirection:direction},direction==="row"?{left:0}:{top:0},controlsWrapperStyle],__source:{fileName:_jsxFileName,lineNumber:211}},_react.default.createElement(_reactNative.View,{style:{opacity:!activeIndex?overRangeButtonsOpacity:1},__source:{fileName:_jsxFileName,lineNumber:214}},_react.default.createElement(_reactNative.TouchableOpacity,{disabled:!activeIndex&&!loop,onPress:function onPress(){return _this5.moveUpDown(true);},__source:{fileName:_jsxFileName,lineNumber:215}},prevButtonElement||_react.default.createElement(_reactNative.Text,{style:[styles.prevButtonStyle,prevButtonStyle],__source:{fileName:_jsxFileName,lineNumber:216}},prevButtonText))),_react.default.createElement(_reactNative.View,{style:[{flexDirection:direction},styles.dotsWrapperStyle,dotsWrapperStyle],__source:{fileName:_jsxFileName,lineNumber:219}},children.map(function(el,i){return _react.default.createElement(_reactNative.View,{key:i,__source:{fileName:_jsxFileName,lineNumber:221}},i===activeIndex?activeDotElement||_react.default.createElement(_reactNative.View,{style:[styles.activeDotStyle,activeDotStyle],__source:{fileName:_jsxFileName,lineNumber:223}}):dotElement||_react.default.createElement(_reactNative.View,{style:[styles.dotStyle,dotStyle],__source:{fileName:_jsxFileName,lineNumber:224}}));})),_react.default.createElement(_reactNative.View,{style:{opacity:activeIndex+1>=this.count?overRangeButtonsOpacity:1},__source:{fileName:_jsxFileName,lineNumber:228}},_react.default.createElement(_reactNative.TouchableOpacity,{disabled:activeIndex+1>=this.count&&!loop,onPress:function onPress(){return _this5.moveUpDown();},__source:{fileName:_jsxFileName,lineNumber:229}},nextButtonElement||_react.default.createElement(_reactNative.Text,{style:[styles.nextButtonStyle,nextButtonStyle],__source:{fileName:_jsxFileName,lineNumber:230}},nextButtonText))))));}}]);return Swiper;}(_react.default.Component);exports.default=Swiper;Swiper.propTypes={direction:_propTypes.default.oneOf(["row","column"]),index:_propTypes.default.number,onIndexChanged:_propTypes.default.func,actionMinWidth:_propTypes.default.number,children:_propTypes.default.node.isRequired,overRangeButtonsOpacity:_propTypes.default.number,loop:_propTypes.default.bool,autoplayTimeout:_propTypes.default.number,containerStyle:_reactNative.ViewPropTypes.style,swipeAreaStyle:_reactNative.ViewPropTypes.style,swipeWrapperStyle:_reactNative.ViewPropTypes.style,controlsWrapperStyle:_reactNative.ViewPropTypes.style,dotsWrapperStyle:_reactNative.ViewPropTypes.style,dotStyle:_reactNative.ViewPropTypes.style,dotElement:_propTypes.default.element,activeDotStyle:_reactNative.ViewPropTypes.style,activeDotElement:_propTypes.default.element,prevButtonStyle:_reactNative.Text.propTypes.style,prevButtonElement:_propTypes.default.element,prevButtonText:_propTypes.default.string,nextButtonStyle:_reactNative.Text.propTypes.style,nextButtonElement:_propTypes.default.element,nextButtonText:_propTypes.default.string};Swiper.defaultProps={direction:"row",index:0,actionMinWidth:0.25,overRangeButtonsOpacity:0,loop:false,autoplayTimeout:0,prevButtonText:"",nextButtonText:""};